<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Performance Test - Synapse Landing Page</title>
    <link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet" href="styles/components.css">
    <link rel="stylesheet" href="styles/animations.css">
    <style>
        .test-container {
            max-width: 800px;
            margin: 2rem auto;
            padding: 2rem;
            background: var(--surface-dark);
            border-radius: var(--radius-lg);
        }
        
        .test-section {
            margin-bottom: 2rem;
            padding: 1rem;
            border: 1px solid var(--border-subtle);
            border-radius: var(--radius-base);
        }
        
        .test-result {
            padding: 0.5rem;
            margin: 0.5rem 0;
            border-radius: var(--radius-sm);
            font-family: var(--font-mono);
            font-size: var(--text-sm);
        }
        
        .test-result.pass {
            background: rgba(16, 185, 129, 0.1);
            color: #10B981;
            border: 1px solid rgba(16, 185, 129, 0.2);
        }
        
        .test-result.fail {
            background: rgba(239, 68, 68, 0.1);
            color: #EF4444;
            border: 1px solid rgba(239, 68, 68, 0.2);
        }
        
        .test-result.info {
            background: rgba(59, 130, 246, 0.1);
            color: var(--accent-blue);
            border: 1px solid rgba(59, 130, 246, 0.2);
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1 class="heading--section">Performance Optimization Tests</h1>
        
        <div class="test-section">
            <h2 class="heading--subsection">Reduced Motion Support</h2>
            <div id="reduced-motion-test"></div>
            <button class="btn btn--secondary" onclick="testReducedMotion()">Test Reduced Motion</button>
        </div>
        
        <div class="test-section">
            <h2 class="heading--subsection">Device Detection</h2>
            <div id="device-detection-test"></div>
            <button class="btn btn--secondary" onclick="testDeviceDetection()">Test Device Detection</button>
        </div>
        
        <div class="test-section">
            <h2 class="heading--subsection">Error Handling</h2>
            <div id="error-handling-test"></div>
            <button class="btn btn--secondary" onclick="testErrorHandling()">Test Error Handling</button>
        </div>
        
        <div class="test-section">
            <h2 class="heading--subsection">Form Retry Mechanism</h2>
            <div id="form-retry-test"></div>
            <form class="form--inline" id="test-form">
                <div class="form__group">
                    <input type="email" class="form__input" placeholder="test@example.com" required>
                    <div class="form__error"></div>
                </div>
                <button type="submit" class="btn btn--primary">Test Submit</button>
            </form>
        </div>
        
        <div class="test-section">
            <h2 class="heading--subsection">Performance Metrics</h2>
            <div id="performance-test"></div>
            <button class="btn btn--secondary" onclick="testPerformance()">Measure Performance</button>
        </div>
    </div>

    <script src="scripts/forms.js"></script>
    <script src="scripts/animations.js"></script>
    <script src="scripts/main.js"></script>
    <script>
        function addTestResult(containerId, message, type = 'info') {
            const container = document.getElementById(containerId);
            const result = document.createElement('div');
            result.className = `test-result ${type}`;
            result.textContent = message;
            container.appendChild(result);
        }
        
        function testReducedMotion() {
            const container = document.getElementById('reduced-motion-test');
            container.innerHTML = '';
            
            // Test if reduced motion is detected
            const reducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
            addTestResult('reduced-motion-test', 
                `Reduced motion preference: ${reducedMotion ? 'ENABLED' : 'DISABLED'}`, 
                reducedMotion ? 'pass' : 'info'
            );
            
            // Test CSS support
            const testElement = document.createElement('div');
            testElement.style.animation = 'test 1s';
            document.body.appendChild(testElement);
            
            const computedStyle = window.getComputedStyle(testElement);
            const animationDuration = computedStyle.animationDuration;
            
            document.body.removeChild(testElement);
            
            addTestResult('reduced-motion-test', 
                `Animation duration: ${animationDuration}`, 
                'info'
            );
        }
        
        function testDeviceDetection() {
            const container = document.getElementById('device-detection-test');
            container.innerHTML = '';
            
            // Test device memory
            const memory = navigator.deviceMemory;
            addTestResult('device-detection-test', 
                `Device memory: ${memory ? memory + 'GB' : 'Unknown'}`, 
                'info'
            );
            
            // Test hardware concurrency
            const cores = navigator.hardwareConcurrency;
            addTestResult('device-detection-test', 
                `CPU cores: ${cores || 'Unknown'}`, 
                'info'
            );
            
            // Test connection
            const connection = navigator.connection || navigator.mozConnection || navigator.webkitConnection;
            if (connection) {
                addTestResult('device-detection-test', 
                    `Connection type: ${connection.effectiveType || 'Unknown'}`, 
                    'info'
                );
                addTestResult('device-detection-test', 
                    `Save data: ${connection.saveData ? 'YES' : 'NO'}`, 
                    connection.saveData ? 'pass' : 'info'
                );
            }
            
            // Test screen size
            addTestResult('device-detection-test', 
                `Screen: ${window.screen.width}x${window.screen.height}`, 
                'info'
            );
        }
        
        function testErrorHandling() {
            const container = document.getElementById('error-handling-test');
            container.innerHTML = '';
            
            // Test if error handlers are set up
            const hasErrorHandler = window.onerror !== null || 
                                  window.addEventListener.toString().includes('error');
            addTestResult('error-handling-test', 
                `Global error handler: ${hasErrorHandler ? 'ACTIVE' : 'INACTIVE'}`, 
                hasErrorHandler ? 'pass' : 'fail'
            );
            
            // Test promise rejection handler
            const hasRejectionHandler = window.onunhandledrejection !== null;
            addTestResult('error-handling-test', 
                `Promise rejection handler: ${hasRejectionHandler ? 'ACTIVE' : 'INACTIVE'}`, 
                hasRejectionHandler ? 'pass' : 'fail'
            );
            
            // Test SynapseApp error handling
            const hasAppErrorHandling = typeof SynapseApp !== 'undefined' && 
                                       typeof SynapseApp.logError === 'function';
            addTestResult('error-handling-test', 
                `App error logging: ${hasAppErrorHandling ? 'AVAILABLE' : 'UNAVAILABLE'}`, 
                hasAppErrorHandling ? 'pass' : 'fail'
            );
        }
        
        function testPerformance() {
            const container = document.getElementById('performance-test');
            container.innerHTML = '';
            
            // Test Performance API availability
            const hasPerformance = 'performance' in window;
            addTestResult('performance-test', 
                `Performance API: ${hasPerformance ? 'AVAILABLE' : 'UNAVAILABLE'}`, 
                hasPerformance ? 'pass' : 'fail'
            );
            
            if (hasPerformance) {
                // Test memory info
                if (performance.memory) {
                    const memory = performance.memory;
                    const usedMB = Math.round(memory.usedJSHeapSize / 1048576);
                    const totalMB = Math.round(memory.totalJSHeapSize / 1048576);
                    addTestResult('performance-test', 
                        `Memory usage: ${usedMB}MB / ${totalMB}MB`, 
                        'info'
                    );
                }
                
                // Test navigation timing
                const navigation = performance.getEntriesByType('navigation')[0];
                if (navigation) {
                    const loadTime = Math.round(navigation.loadEventEnd - navigation.navigationStart);
                    addTestResult('performance-test', 
                        `Page load time: ${loadTime}ms`, 
                        loadTime < 3000 ? 'pass' : 'fail'
                    );
                }
                
                // Test observer support
                const hasObserver = 'PerformanceObserver' in window;
                addTestResult('performance-test', 
                    `Performance Observer: ${hasObserver ? 'SUPPORTED' : 'NOT SUPPORTED'}`, 
                    hasObserver ? 'pass' : 'info'
                );
            }
        }
        
        // Initialize test form
        document.addEventListener('DOMContentLoaded', function() {
            const testForm = document.getElementById('test-form');
            if (testForm) {
                new EmailCapture(testForm);
                
                // Override submit to test retry mechanism
                testForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    // Simulate error to test retry mechanism
                    const emailCapture = testForm.emailCapture || new EmailCapture(testForm);
                    emailCapture.showError('Test error - retry mechanism active', true);
                    
                    addTestResult('form-retry-test', 
                        'Error displayed with retry button', 
                        'pass'
                    );
                });
            }
        });
    </script>
</body>
</html>